<?php

  // TO DO:
  // 1. fix everything  DONE!
  // 2. write at least two more questions  DONE!
  // 3. make suggestions based on questions  DONE!

  function pastry_quiz_menu() {
    $items['quiz'] = array(
      'title' => 'What should I eat!?',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('start_form'),
      'access callback' => TRUE,
      'type' => MENU_NORMAL_ITEM,
    );

    $items['quiz_question_1'] = array(
      'page callback' => 'drupal_get_form',
      'page arguments' => array('quiz_one_form'),
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );

    $items['quiz_question_2'] = array(
      'page callback' => 'drupal_get_form',
      'page arguments' => array('quiz_two_form'),
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );

    $items['quiz_question_3'] = array(
      'page callback' => 'drupal_get_form',
      'page arguments' => array('quiz_three_form'),
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );

    $items['quiz_results'] = array(
      'title' => 'Quiz Results!',
      'page callback' => 'quiz_success',
      'access callback' => TRUE,
      'type' => MENU_CALLBACK,
    );
    return $items;
  }

  function start_form() {
    $form['begin'] = array(
      '#title' => t("Are you ready to take our quiz to see if Cameron's Bakery is right for you?"),
      '#type' => 'radios',
      '#options' => array(
        t('Yes!'),
      ),
      '#required' => TRUE,
    );

    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => 'Start Quiz',
    );
    return $form;
  }

  function start_form_submit($form, &$form_state) {
    $form_state['redirect'] = 'quiz_question_1';
  }

  function quiz_one_form() {
    $form['gluten'] = array(
      '#title' => 'Do you tolerate gluten?',
      '#type' => 'radios',
      '#options' => array(
        t('I find gluten to be an essential part of every meal I eat'),
        t("If I'm even in the same room as gluten I reach for the Beano"),
      ),
      '#required' => TRUE,
    );

    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => 'submit',
    );
    return $form;
  }

  function quiz_one_form_submit($form, &$form_state) {
    $form['gluten']['default_value'] = variable_get('comment_preview', 1);
    $gluten = $form_state['values']['gluten'];
    $_SESSION['gluten'] = $gluten;
    $form_state['redirect'] = 'quiz_question_2';
  }

  function quiz_two_form() {
    $form['chocolate'] = array(
      '#title' => 'Okay, what are your feelings on chocolate?',
      '#type' => 'radios',
      '#options' => array(
        t('Chocolate has been my lifetime companion through thick and thin.'),
        t('I see the appeal of chocolate and I occasionally find it enjoyable.'),
        t('I recognize that chocolate is a popular desert among many individuals but I personally find it repugnant.'),
      ),
      '#required' => TRUE,
    );

    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => 'submit',
    );
    return $form;
  }

  function quiz_two_form_submit($form, &$form_state) {
    $form['chocolate']['default_value'] = variable_get('comment_preview', 1);
    $chocolate = $form_state['values']['chocolate'];
    $_SESSION['chocolate'] = $chocolate;
    $form_state['redirect'] = 'quiz_question_3';
  }

  function quiz_three_form() {
    $form['cake_v_pie'] = array(
      '#title' => 'Well do you prefer creamy, frosting-covered cakes or fruity, flakey pies?',
      '#type' => 'radios',
      '#options' => array(
        t('Cake is clearly superior to pie in every way.'),
        t('I eat pie for breakfast, pie for lunch and pie for dinner. It is the perfect dessert.'),
      ),
      '#required' => TRUE,
    );

    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => 'submit',
    );
    return $form;
  }

  function quiz_three_form_submit($form, &$form_state) {
    $form['cake_v_pie']['default_value'] = variable_get('comment_preview', 1);
    $cake_v_pie = $form_state['values']['cake_v_pie'];
    $_SESSION['cake_v_pie'] = $cake_v_pie;
    $form_state['redirect'] = 'quiz_results';
  }

  function quiz_success() {
    $gluten = $_SESSION['gluten'];
    $chocolate = $_SESSION['chocolate'];
    $cake_v_pie = $_SESSION['cake_v_pie'];
    if ($_SESSION['gluten'] == 0) {
      $gluten = 'gluten-filled';
    } else {
      $gluten = 'gluten-free';
    }
    if ($_SESSION['chocolate'] == 0) {
      $chocolate = 'super-chocolatey';
    } elseif ($_SESSION['chocolate'] == 1) {
      $chocolate = 'kinda-chocolatey';
    } else {
      $chocolate = 'chocolateless';
    }
    if ($_SESSION['cake_v_pie'] == 0) {
      $cake_v_pie = 'cake';
    } else {
      $cake_v_pie = 'pie';
    }
    return "<p>Lucky you, we hve just the thing! Come into Cameron's and try our " . $gluten . ", " . $chocolate . " " . $cake_v_pie . "!</p>";
  }
