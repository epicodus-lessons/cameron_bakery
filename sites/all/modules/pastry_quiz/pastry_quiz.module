<?php

// TO DO:
// 1. fix everything
// 2. write at least two more questions
// 3. make suggestions based on questions


// Quiz menu function - different pages displayed to user during quiz

function pastry_quiz_menu() {
  $items['quiz'] = array(
    'title' => 'What should I eat!?',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('start_form'),
    'access callback' => TRUE,
    'type' => MENU_NORMAL_ITEM,
  );

  $items['quiz_question_1'] = array(
    'page callback' => 'drupal_get_form',
    'page arguments' => array('pastry_quiz_q1_form'),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  $items['quiz_question_2'] = array(
    'page callback' => 'drupal_get_form',
    'page arguments' => array('pastry_quiz_q2_form'),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  $items['quiz_question_3'] = array(
    'page callback' => 'drupal_get_form',
    'page arguments' => array('pastry_quiz_q3_form'),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  $items['quiz_results'] = array(
    'title' => 'Quiz Results!',
    'page callback' => 'quiz_success',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  return $items;
}


// Quiz question form functions - display questions to user

function start_form() {
  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Start Quiz!',
  );

  return $form;
}

function pastry_quiz_q1_form() {
  $form['gluten'] = array(
    '#title' => 'Gluten Intolerance',
    '#description' => t('Are you gluten intolerant?'),
    '#type' => 'radios',
    '#options' => array(
      'yes' => t('Yes'),
      'no' => t('No'),
    ),
    '#required' => TRUE,
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Next question!',
  );

  return $form;
}

function pastry_quiz_q2_form() {
  $form['chocolate'] = array(
    '#title' => 'Chocolate',
    '#description' => t('Do you like chocolate?'),
    '#type' => 'radios',
    '#options' => array(
      'yes' => t('Yes'),
      'no' => t('No'),
    ),
    '#required' => TRUE,
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Next question!',
  );

  return $form;
}

function pastry_quiz_q3_form() {
  $form['savory'] = array(
    '#title' => 'Savory Pastries',
    '#description' => t('Do you prefer savory pastries over sweet?'),
    '#type' => 'radios',
    '#options' => array(
      'yes' => t('Yes'),
      'no' => t('No'),
    ),
    '#required' => TRUE,
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Calculate results!',
  );

  return $form;
}


// Quiz form submit functions - store form data in $_SESSION and redirect to next question in menu

function start_form_submit($form, &$form_state) {
  $form_state['redirect'] = 'quiz_question_1';
}

function pastry_quiz_q1_form_submit($form, &$form_state) {
  $gluten_intolerant = $form_state['values']['gluten'];

  $_SESSION['gluten'] = $gluten_intolerant;
  $form_state['redirect'] = 'quiz_question_2';
}

function pastry_quiz_q2_form_submit($form, &$form_state) {
  $chocolate = $form_state['values']['chocolate'];

  $_SESSION['chocolate'] = $chocolate;
  $form_state['redirect'] = 'quiz_question_3';
}

function pastry_quiz_q3_form_submit($form, &$form_state) {
  $savory = $form_state['values']['savory'];

  $_SESSION['savory'] = $savory;
  $form_state['redirect'] = 'quiz_results';
}


// Final quiz results - pull all form data back from $_SESSION and process

function quiz_success() {
  $gluten_intolerant = $_SESSION['gluten'];
  $chocolate = $_SESSION['chocolate'];
  $savory = $_SESSION['savory'];

  if ($gluten_intolerant == 'yes') {
    return "<p>Try our gluten-free blueberry almond muffins!</p>";
  } elseif ($chocolate == 'yes') {
    return "<p>Try our chocolate croissants!</p>";
  } elseif ($savory == 'yes') {
    return "<p>Try our bacon cheddar scones!</p>";
  } else {
    return "<p>Try our caramel apple tart!</p>";
  }
}
