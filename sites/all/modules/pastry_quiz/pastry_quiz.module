<?php

// TO DO:
// 1. fix everything
// 2. write at least two more questions
// 3. make suggestions based on questions

function pastry_quiz_menu() {
    $items['quiz'] = array(
        'title' => 'What should I eat!?',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('start_form'),
        'access callback' => TRUE,
        'type' => MENU_NORMAL_ITEM,
    );

    $items['quiz_question1'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('quiz_form1'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_question2'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('quiz_form2'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_question3'] = array(
        'page callback' => 'drupal_get_form',
        'page arguments' => array('quiz_form3'),
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    $items['quiz_results'] = array(
        'title' => 'Quiz Results!',
        'page callback' => 'quiz_success',
        'access callback' => TRUE,
        'type' => MENU_CALLBACK,
    );

    return $items;
}

function start_form() {
    $form['submit'] = array(
        '#type' => 'submit',
        '#description' => t('Are you ready to find the right pastry for you?'),
        '#value' => t('submit'),
    );

    return $form;
}

function quiz_form1() {
    $form['gluten'] = array(
        '#title' => t('Gluten Intolerance'),
        '#type' => 'radios',
        '#description' => t('Are you gluten intolerant?'),
        '#options' => array(
            t('Yes'),
            t('No'),
        ),
        '#required' => TRUE,
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'submit',
    );

    return $form;
}

function quiz_form2() {
    $form['lactose'] = array(
        '#title' => t('Lactose Intolerance'),
        '#type' => 'radios',
        '#description' => t('Are you lactose intolerant?'),
        '#options' => array(
            t('Yes'),
            t('No'),
        ),
        '#required' => TRUE,
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'submit',
    );

    return $form;
}

function quiz_form3() {
    $form['pastry'] = array(
        '#title' => t('Pastry Intolerance'),
        '#type' => 'radios',
        '#description' => t('Are you pastry intolerant?'),
        '#options' => array(
            t('Yes'),
            t('No'),
        ),
        '#required' => TRUE,
    );

    $form['submit'] = array(
        '#type' => 'submit',
        '#value' => 'submit',
    );

    return $form;
}

function start_form_submit($form, &$form_state) {
    $form_state['redirect'] = 'quiz_question1';
}

function quiz_form1_submit($form, &$form_state) {
    $gluten = $form_state['values']['gluten'];
    $_SESSION['gluten'] = $gluten;
    $form_state['redirect'] = 'quiz_question2';
}

function quiz_form2_submit($form, &$form_state) {
    $lactose = $form_state['values']['lactose'];
    $_SESSION['lactose'] = $lactose;
    $form_state['redirect'] = 'quiz_question3';
}

function quiz_form3_submit($form, &$form_state) {
    $pastry = $form_state['values']['pastry'];
    $_SESSION['pastry'] = $pastry;
    $form_state['redirect'] = 'quiz_results';
}

function quiz_success() {
    $gluten = $_SESSION['gluten'];
    $lactose = $_SESSION['lactose'];
    $pastry = $_SESSION['pastry'];

    if ($gluten && $pastry && $lactose) {
        return '<p>Get a cheese danish!</p>';
    } else if ($gluten && $pastry) {
        return '<p>Get a donut!</p>';
    } else if ($pastry && $lactose) {
        return '<p>Get the Creme Brulee!</p>';
    } else if ($lactose) {
        return '<p>Here\'s some milk.</p>';
    } else if ($gluten) {
        return '<p>We\'ve got bread.</p>';
    } else {
        return "<p>Yeah... You can definitely leave.</p>";
    }
}
